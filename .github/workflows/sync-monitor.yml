name: Monitor Public Sync

on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:

jobs:
  check-sync:
    runs-on: ubuntu-latest
    steps:
    - name: Check sync status
      run: |
        # Get last commit times
        PRIVATE_COMMIT=$(curl -s https://api.github.com/repos/the-omics-os/lobster/commits/main | jq -r '.commit.committer.date')
        PUBLIC_COMMIT=$(curl -s https://api.github.com/repos/the-omics-os/lobster-local/commits/main | jq -r '.commit.committer.date')
        
        # Convert to timestamps
        PRIVATE_TS=$(date -d "$PRIVATE_COMMIT" +%s)
        PUBLIC_TS=$(date -d "$PUBLIC_COMMIT" +%s)
        
        # Check if public is behind by more than 24 hours
        DIFF=$((PRIVATE_TS - PUBLIC_TS))
        if [ $DIFF -gt 86400 ]; then
          echo "⚠️ Public repo is behind by more than 24 hours!"
          echo "Private repo last commit: $PRIVATE_COMMIT"
          echo "Public repo last commit: $PUBLIC_COMMIT"
          echo "Difference: $((DIFF / 3600)) hours"
          exit 1
        else
          echo "✅ Public repo is up to date"
          echo "Private repo last commit: $PRIVATE_COMMIT"
          echo "Public repo last commit: $PUBLIC_COMMIT"
          echo "Difference: $((DIFF / 3600)) hours"
        fi
