---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lobster/core/schemas/search.py
  - lobster/core/vector/__init__.py
  - lobster/core/vector/backends/__init__.py
  - lobster/core/vector/backends/base.py
  - lobster/core/vector/embeddings/__init__.py
  - lobster/core/vector/embeddings/base.py
autonomous: true
requirements:
  - SCHM-01
  - SCHM-02
  - INFRA-03
  - EMBED-01

must_haves:
  truths:
    - "SearchResult and OntologyMatch Pydantic models can be instantiated with term, ontology_id, score, metadata, and distance_metric fields"
    - "SearchBackend, EmbeddingProvider, and RerankerType enums contain the correct members (chromadb/faiss/pgvector, sapbert/minilm/openai, cross_encoder/cohere/none)"
    - "BaseVectorBackend ABC defines add_documents, search, delete, count abstract methods"
    - "BaseEmbedder ABC defines embed_text, embed_batch, dimensions abstract methods"
    - "Importing lobster.core.vector does not import chromadb or sentence-transformers (lazy loading preserved)"
  artifacts:
    - path: "lobster/core/schemas/search.py"
      provides: "Pydantic models and enums for vector search results"
      contains: "class OntologyMatch"
    - path: "lobster/core/vector/backends/base.py"
      provides: "BaseVectorBackend ABC with 4 abstract methods + collection_exists default"
      contains: "class BaseVectorBackend"
    - path: "lobster/core/vector/embeddings/base.py"
      provides: "BaseEmbedder ABC with embed_text, embed_batch, dimensions"
      contains: "class BaseEmbedder"
  key_links:
    - from: "lobster/core/vector/__init__.py"
      to: "lobster/core/vector/backends/base.py"
      via: "__all__ list (no eager import of implementations)"
      pattern: "__all__"
    - from: "lobster/core/schemas/search.py"
      to: "pydantic"
      via: "BaseModel subclasses"
      pattern: "class.*BaseModel"
---

<objective>
Create the foundational type system for vector search: Pydantic schemas (SearchResult, OntologyMatch, enums), BaseVectorBackend ABC, and BaseEmbedder ABC.

Purpose: These types are the interface contracts that all implementations (Plans 02-03) depend on. Clean ABCs ensure pluggable backends (Phase 5) and pluggable embedders (Phase 5+) can be added without changing callers.

Output: 6 new files defining the complete type system for vector search infrastructure.
</objective>

<execution_context>
@/Users/tyo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tyo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@lobster/core/schemas/ontology.py
@lobster/core/interfaces/backend.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Pydantic schemas and enums for vector search</name>
  <files>lobster/core/schemas/search.py</files>
  <action>
Create `lobster/core/schemas/search.py` with the following Pydantic v2 models and enums:

**Enums (str, Enum):**
- `SearchBackend`: chromadb, faiss, pgvector
- `EmbeddingProvider`: sapbert, minilm, openai
- `RerankerType`: cross_encoder, cohere, none

**Pydantic Models:**
- `OntologyMatch(BaseModel)`: Fields: `term: str`, `ontology_id: str`, `score: float` (0-1, rounded to 4 decimal places), `metadata: dict[str, Any]` (default empty dict), `distance_metric: str` (default "cosine"). This is the per-result match as specified in user decisions (flat, simple).
- `SearchResult(BaseModel)`: Fields: `query: str`, `collection: str`, `matches: list[OntologyMatch]`, `top_k: int`, `total_in_collection: int | None` (default None, for diagnostics).
- `LiteratureMatch(BaseModel)`: Fields: `title: str`, `pmid: str | None`, `score: float`, `metadata: dict[str, Any]` (default empty dict), `distance_metric: str` (default "cosine"). Defined per SCHM-01 requirement, implementation deferred.
- `SearchResponse(BaseModel)`: Fields: `results: list[SearchResult]`, `backend: SearchBackend`, `embedding_provider: EmbeddingProvider`, `reranker: RerankerType | None` (default None).

Follow existing schema conventions from `lobster/core/schemas/ontology.py`: use `Field(description=...)` for every field, include module docstring explaining purpose.

Do NOT import chromadb, sentence-transformers, or any heavy dependencies.
  </action>
  <verify>
Run: `cd /Users/tyo/omics-os/lobster && python -c "from lobster.core.schemas.search import OntologyMatch, SearchResult, SearchBackend, EmbeddingProvider, RerankerType, LiteratureMatch, SearchResponse; m = OntologyMatch(term='test', ontology_id='MONDO:001', score=0.95, metadata={}, distance_metric='cosine'); print(m.model_dump()); print('Enums:', list(SearchBackend), list(EmbeddingProvider), list(RerankerType))"`

Expected: Model instantiation succeeds, all enum values printed correctly.
  </verify>
  <done>All 4 Pydantic models and 3 enums importable from lobster.core.schemas.search. OntologyMatch has term, ontology_id, score, metadata, distance_metric fields. Enums have all specified members.</done>
</task>

<task type="auto">
  <name>Task 2: Create BaseVectorBackend ABC and BaseEmbedder ABC with module structure</name>
  <files>
    lobster/core/vector/__init__.py
    lobster/core/vector/backends/__init__.py
    lobster/core/vector/backends/base.py
    lobster/core/vector/embeddings/__init__.py
    lobster/core/vector/embeddings/base.py
  </files>
  <action>
Create the `lobster/core/vector/` module structure with ABCs.

**`lobster/core/vector/backends/base.py`** — `BaseVectorBackend` ABC:
- 4 abstract methods matching research Pattern 6:
  - `add_documents(collection_name: str, ids: list[str], embeddings: list[list[float]], documents: list[str] | None = None, metadatas: list[dict[str, Any]] | None = None) -> None`
  - `search(collection_name: str, query_embedding: list[float], n_results: int = 5) -> dict[str, Any]` — returns raw backend results (column-oriented for ChromaDB)
  - `delete(collection_name: str, ids: list[str]) -> None`
  - `count(collection_name: str) -> int`
- 1 concrete default method:
  - `collection_exists(collection_name: str) -> bool` — try count(), return True; except return False
- Include comprehensive docstrings on each method explaining the contract.

**`lobster/core/vector/embeddings/base.py`** — `BaseEmbedder` ABC:
- 2 abstract methods + 1 abstract property matching research Pattern 5:
  - `embed_text(text: str) -> list[float]` — embed single text
  - `embed_batch(texts: list[str]) -> list[list[float]]` — embed multiple texts
  - `dimensions` property (abstract) — return embedding dimensionality (e.g., 768)
- 1 concrete property:
  - `name` — returns `self.__class__.__name__` (human-readable provider name)

**`lobster/core/vector/__init__.py`:**
- Define `__all__` with public API names: `["BaseVectorBackend", "BaseEmbedder", "VectorSearchService", "VectorSearchConfig"]`
- Use `TYPE_CHECKING` guard for imports to avoid loading implementations at import time
- CRITICAL: Do NOT eagerly import any implementation classes. Only expose names via `__all__`. Actual imports happen when callers explicitly `from lobster.core.vector.backends.base import BaseVectorBackend`. This ensures `lobster --help` stays <500ms.

**`lobster/core/vector/backends/__init__.py`** and **`lobster/core/vector/embeddings/__init__.py`:**
- Empty or minimal with `__all__` listing the base class only. No eager imports.

Follow existing ABC patterns from `lobster/core/interfaces/backend.py` for style (docstrings with Args/Returns/Raises sections).
  </action>
  <verify>
Run: `cd /Users/tyo/omics-os/lobster && python -c "from lobster.core.vector.backends.base import BaseVectorBackend; from lobster.core.vector.embeddings.base import BaseEmbedder; print('ABC methods:', [m for m in dir(BaseVectorBackend) if not m.startswith('_')]); print('Embedder methods:', [m for m in dir(BaseEmbedder) if not m.startswith('_')])"`

Verify no heavy imports: `cd /Users/tyo/omics-os/lobster && python -c "import sys; pre = set(sys.modules.keys()); from lobster.core.vector.backends.base import BaseVectorBackend; from lobster.core.vector.embeddings.base import BaseEmbedder; post = set(sys.modules.keys()); new = post - pre; assert 'chromadb' not in new and 'sentence_transformers' not in new and 'torch' not in new, f'Heavy imports detected: {new}'; print('No heavy imports - OK')"`
  </verify>
  <done>BaseVectorBackend ABC has add_documents, search, delete, count abstract methods plus collection_exists default. BaseEmbedder ABC has embed_text, embed_batch abstract methods plus dimensions abstract property. Importing these ABCs does not trigger chromadb or torch imports.</done>
</task>

</tasks>

<verification>
1. All 6 files exist under the correct paths
2. `from lobster.core.schemas.search import OntologyMatch, SearchResult, SearchBackend, EmbeddingProvider, RerankerType` succeeds
3. `from lobster.core.vector.backends.base import BaseVectorBackend` succeeds
4. `from lobster.core.vector.embeddings.base import BaseEmbedder` succeeds
5. No chromadb, sentence-transformers, or torch in sys.modules after importing the above
6. `OntologyMatch(term="x", ontology_id="y", score=0.5, metadata={}, distance_metric="cosine")` creates valid instance
</verification>

<success_criteria>
- 4 Pydantic models (OntologyMatch, SearchResult, LiteratureMatch, SearchResponse) and 3 enums (SearchBackend, EmbeddingProvider, RerankerType) defined in search.py
- BaseVectorBackend ABC with 4 abstract methods + collection_exists default method
- BaseEmbedder ABC with 2 abstract methods + dimensions property + name property
- Module structure created at lobster/core/vector/ with lazy-loading __init__.py
- Zero heavy dependency imports at module level
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
