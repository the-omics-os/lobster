```mermaid
sequenceDiagram
    participant User
    participant TestScript
    participant AgentClient
    participant ResearchAgent
    participant GEOService
    participant ValidationService
    participant StrategyRecommender
    participant DownloadQueue

    User->>TestScript: Run integration test
    TestScript->>AgentClient: Initialize client
    AgentClient-->>TestScript: âœ… Client ready

    Note over TestScript: PHASE 1: Validation + Queue Creation

    TestScript->>AgentClient: query("Validate and add GSE139555...")
    AgentClient->>ResearchAgent: Route to research_agent

    ResearchAgent->>GEOService: fetch_metadata("GSE139555")
    GEOService-->>ResearchAgent: Metadata (title, summary, GPL20301)

    ResearchAgent->>GEOService: detect_modality()
    GEOService-->>ResearchAgent: scrna_10x (confidence: 0.95)

    ResearchAgent->>ValidationService: validate_metadata()
    ValidationService-->>ResearchAgent: validation_failed (missing condition)

    ResearchAgent->>GEOService: get_download_urls()
    GEOService-->>ResearchAgent: matrix_url + 8 supplementary

    ResearchAgent->>StrategyRecommender: recommend_strategy()
    StrategyRecommender-->>ResearchAgent: MATRIX_FIRST (confidence: 0.85)

    ResearchAgent->>DownloadQueue: add_entry(GSE139555, strategy, urls)
    DownloadQueue-->>ResearchAgent: queue_GSE139555_4bcbc050

    ResearchAgent-->>AgentClient: Success response
    AgentClient-->>TestScript: âœ… Entry created

    Note over TestScript: PHASE 2: Queue Entry Verification

    TestScript->>DownloadQueue: list_entries(status="pending")
    DownloadQueue-->>TestScript: [GSE139555 entry, ...]

    TestScript->>TestScript: Verify entry fields

    rect rgb(200, 255, 200)
        Note over TestScript: CHECK 1: validation_status âœ…
        Note over TestScript: CHECK 2: recommended_strategy âœ…
        Note over TestScript: CHECK 3: URLs extracted âœ…
        Note over TestScript: CHECK 4: Confidence score 0.85 âœ…
        Note over TestScript: CHECK 5: Queue entry created âœ…
    end

    TestScript-->>User: ðŸŽ‰ ALL TESTS PASSED (5/5)
```
